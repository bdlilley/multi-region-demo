apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: gloo-platform
  namespace: argocd
spec:
  destination:
    namespace: gloo-mesh
    server: https://kubernetes.default.svc
  project: default
  source:
    chart: gloo-platform
    helm:
      values: |
        common:
          cluster: mgmt-cluster
        demo:
          manageAddonNamespace: true
        extAuthService:
          enabled: false
        glooMgmtServer:
          enabled: true
          env:
          - name: REDIS_USERNAME
            value: ""
          - name: REDIS_PASSWORD
            valueFrom:
              secretKeyRef:
                key: token
                name: redis-config
          relay:
            disableCa: true
            disableCaCertGeneration: true
            disableTokenGeneration: true
            pushRbac: true
            tlsSecret:
              name: relay-server-tls-secret
          serviceOverrides:
            metadata:
              annotations:
                service.beta.kubernetes.io/aws-load-balancer-backend-protocol: TCP
                service.beta.kubernetes.io/aws-load-balancer-cross-zone-load-balancing-enabled: "true"
                service.beta.kubernetes.io/aws-load-balancer-nlb-target-type: instance
                service.beta.kubernetes.io/aws-load-balancer-scheme: internal
                service.beta.kubernetes.io/aws-load-balancer-type: external
        glooUi:
          enabled: true
          env:
          - name: REDIS_USERNAME
            value: ""
          - name: REDIS_PASSWORD
            valueFrom:
              secretKeyRef:
                key: token
                name: redis-config
        istioInstallations:
          controlPlane:
            enabled: true
            gatewayRevision: 1-17-2
          enabled: true
          northSouthGateways:
          - enabled: false
        legacyMetricsPipeline:
          enabled: false
        licensing:
          licenseSecretName: license-keys
        prometheus:
          enabled: true
        redis:
          address: master.solo-v0-ha-testing-primary.cc3vei.use1.cache.amazonaws.com:6379
          auth:
            enabled: true
          certs:
            enabled: true
          db: 0
          deployment:
            enabled: false
          passwordKey: token
          secretName: redis-config
        telemetryCollector:
          config:
            exporters:
              otlp:
                endpoint: gloo-telemetry-gateway.gloo-mesh:4317
          enabled: true
        telemetryGateway:
          enabled: true
          service:
            annotations:
              service.beta.kubernetes.io/aws-load-balancer-backend-protocol: TCP
              service.beta.kubernetes.io/aws-load-balancer-cross-zone-load-balancing-enabled: "true"
              service.beta.kubernetes.io/aws-load-balancer-nlb-target-type: instance
              service.beta.kubernetes.io/aws-load-balancer-scheme: internal
              service.beta.kubernetes.io/aws-load-balancer-type: external
            type: LoadBalancer
        global:
          common:
            cluster: mgmt-cluster
    repoURL: https://storage.googleapis.com/gloo-platform-dev/platform-charts/helm-charts
    targetRevision: v2.4.0-beta2-2023-07-11-main-e45f3984c
  syncPolicy:
    syncOptions:
    - CreateNamespace=false
